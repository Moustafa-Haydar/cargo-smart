<div class="page-container">
    <header class="page-header">
        <h1>Route Proposals</h1>
        <div class="user-info">
            <i class="fas fa-user-circle"></i>
            <span>Operations Manager</span>
        </div>
    </header>

    <search-section [options]="actionOptions" [placeHolder]="'Filter by action'" [(searchQuery)]="searchQuery"
        [(selected)]="selectedAction" (search)="applySearch($event)" (filterChange)="applyFilter($event)">
    </search-section>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
        <div class="loading-spinner"></div>
        <p>Loading route proposals...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="error-container">
        <i class="fas fa-exclamation-triangle"></i>
        <p>{{ error }}</p>
        <button class="btn-retry" (click)="loadProposals()">Retry</button>
    </div>

    <!-- Proposals Grid -->
    <div *ngIf="!loading && !error" class="proposals-grid">
        <div *ngFor="let proposal of filteredProposals" class="proposal-card">
            <!-- Proposal Header -->
            <div class="proposal-header">
                <div class="proposal-info">
                    <h3>Shipment: {{ proposal.shipment_id.substring(0, 8) }}...</h3>
                    <span class="action-badge" [ngClass]="'action-' + proposal.action">
                        {{ proposal.action === 'propose_switch' ? 'Propose Switch' : 'Stick' }}
                    </span>
                </div>
                <div class="proposal-meta">
                    <p><strong>Created:</strong> {{ proposal.created_at | date:'short' }}</p>
                    <p><strong>Requires Approval:</strong> {{ proposal.requires_approval ? 'Yes' : 'No' }}</p>
                </div>
            </div>

            <!-- Current Route -->
            <div class="route-section">
                <h4>Current Route</h4>
                <div class="route-card current-route">
                    <div class="route-info">
                        <p><strong>Route ID:</strong> {{ proposal.current?.route_id || 'N/A' }}</p>
                        <p><strong>ETA:</strong> {{ formatTime(proposal.current?.eta_minutes || 0) }}</p>
                        <p><strong>Cost:</strong> ${{ proposal.current?.toll_cost_usd || 0 }}</p>
                        <p><strong>Delay Risk:</strong> {{ formatDelayRisk(proposal.current?.p_delay || 0) }}</p>
                    </div>
                </div>
            </div>

            <!-- AI Proposal Route -->
            <div *ngIf="proposal.action === 'propose_switch'" class="route-section">
                <h4>AI Proposal <span class="proposal-badge">NEW</span></h4>
                <div class="route-card proposal-route">
                    <div class="route-info">
                        <p><strong>Route ID:</strong> {{ proposal.proposal?.route_id }}</p>
                        <p><strong>ETA:</strong> {{ formatTime(proposal.proposal?.eta_minutes || 0) }}</p>
                        <p><strong>Cost:</strong> ${{ proposal.proposal?.toll_cost_usd || 0 }}</p>
                        <p><strong>Delay Risk:</strong> {{ formatDelayRisk(proposal.proposal?.p_delay || 0) }}</p>
                    </div>

                    <div class="proposal-details">
                        <p><strong>Improvement:</strong> {{ proposal.rationale }}</p>
                    </div>

                    <div class="proposal-actions">
                        <button class="btn-accept" (click)="acceptProposal(proposal)">
                            <i class="fas fa-check"></i>
                            Accept Proposal
                        </button>
                        <button class="btn-reject" (click)="rejectProposal(proposal)">
                            <i class="fas fa-times"></i>
                            Reject
                        </button>
                    </div>
                </div>
            </div>

            <!-- No Proposal -->
            <div *ngIf="proposal.action === 'stick'" class="route-section">
                <div class="no-proposal">
                    <i class="fas fa-check-circle"></i>
                    <p>Current route is optimal - no changes needed</p>
                    <p class="rationale">{{ proposal.rationale }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !error && filteredProposals.length === 0" class="empty-state">
        <i class="fas fa-route"></i>
        <h3>No proposals found</h3>
        <p>Try adjusting your search or filter criteria.</p>
    </div>
</div>