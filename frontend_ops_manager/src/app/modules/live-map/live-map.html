<div class="page-container">
    <header class="page-header">
        <h1>Live Map</h1>
        <div class="user-info">
            <div class="user">
                <div class="user-avatar">
                    <i class="fas fa-question"></i>
                </div>
                <span>John Doe</span>
            </div>
        </div>
    </header>

    <search-section [options]="shipmentTypeOptions" [placeHolder]="'Filter by type'" [(searchQuery)]="searchQuery"
        [(selected)]="selectedType" (search)="applySearch($event)"
        (filterChange)="applyFilter($event)"></search-section>

    <div class="map-container">
        <!-- <google-map height="600px" width="800px" [options]="options">
            @for (location of nzLocations; track location) {
            <map-advanced-marker #markerElem="mapAdvancedMarker"
                [position]="{ lat: location.lat, lng: location.lng }" />
            } @for (location of auLocations; track location) {
            <map-advanced-marker #markerElem="mapAdvancedMarker"
                [position]="{ lat: location.lat, lng: location.lng }" />
            }
        </google-map> -->

        <google-map [options]="options">
            <map-advanced-marker *ngFor="let m of markers" #markerRef="mapAdvancedMarker" [position]="m.position"
                (mapClick)="openInfo(markerRef, m)">
            </map-advanced-marker>

            <map-info-window>
                <ng-container *ngIf="activeShipment as s">
                    <div class="info">
                        <div class="title">{{ s.ref_no }} • {{ s.shipment_type }}</div>
                        <div>Status: <strong>{{ s.status }}</strong></div>
                        <div>Carrier: {{ s.carrier_name || s.carrier_code }}</div>
                        <div>From: {{ s.origin?.name }} → To: {{ s.destination?.name }}</div>
                        <div *ngIf="s.progress_pct != null">Progress: {{ s.progress_pct }}%</div>
                        <div *ngIf="s.scheduled_at">Scheduled: {{ s.scheduled_at | date:'medium' }}</div>
                        <div *ngIf="s.delivered_at">Delivered: {{ s.delivered_at | date:'medium' }}</div>
                    </div>
                </ng-container>
            </map-info-window>
        </google-map>
    </div>